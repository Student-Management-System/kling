<div
	class="directory"
	data-test="directory"
	*ngIf="{ files: files$ | async } as obs"
	cdkDropList
	[id]="directory.path"
	[cdkDropListData]="obs.files"
	(cdkDropListDropped)="drop($event)"
	[cdkDropListConnectedTo]="dragAndDrop.dropListIds"
>
	<button
		[contextMenu]="directoryContextMenu"
		(click)="toggleIsExpanded()"
		(middleclick)="toggleIsExpanded()"
		class="flex"
	>
		<ng-container *ngIf="isExpanded; else notExpanded">
			<kling-icon name="chevron_down" size="16" class="ml-[-1px] mt-[-1px]"></kling-icon>
			<kling-icon
				name="folder"
				size="16"
				class="pl-[6px] mt-[-1px] pr-2 folder-icon"
			></kling-icon>
		</ng-container>

		<ng-template #notExpanded>
			<kling-icon name="chevron_right" size="16" class="ml-[-1px] mt-[-1px]"></kling-icon>
			<kling-icon
				name="folder"
				size="16"
				class="pl-[6px] mt-[-1px] pr-2 folder-icon"
			></kling-icon>
		</ng-template>

		<span class="directory-name whitespace-nowrap">{{ directory.name }}</span>
	</button>

	<context-menu #directoryContextMenu>
		<ng-template
			contextMenuItem
			(execute)="workspaceDialogs.openCreateFileDialog(directory.path)"
		>
			<span class="context-menu-item" data-test="addFileBtn"
				><kling-icon name="note_add_filled" class="icon-light"></kling-icon
				>{{ "Action.Custom.AddFile" | translate }}</span
			>
		</ng-template>
		<ng-template
			contextMenuItem
			(execute)="workspaceDialogs.openCreateDirectoryDialog(directory.path)"
		>
			<span class="context-menu-item" data-test="addDirectoryBtn"
				><kling-icon name="create_new_folder_filled" class="icon-light"></kling-icon
				>{{ "Action.Custom.AddDirectory" | translate }}</span
			>
		</ng-template>
		<ng-template contextMenuItem (execute)="removeDirectoryIfConfirmed()">
			<span class="context-menu-item" data-test="deleteBtn"
				><kling-icon class="icon-light" name="delete"></kling-icon
				>{{ "Action.Delete" | translate }}</span
			>
		</ng-template>
	</context-menu>

	<div class="indent directory-content" *ngIf="isExpanded">
		<div class="directories">
			<ng-container *ngFor="let dir of directories$ | async">
				<kling-directory
					[directory]="dir"
					[selectedFilePath]="selectedFilePath"
				></kling-directory>
			</ng-container>
		</div>

		<div class="files">
			<kling-file
				*ngFor="let file of obs.files"
				[file]="file"
				[isSelected]="selectedFilePath === file.path"
				cdkDrag
				[cdkDragData]="file"
			></kling-file>
		</div>
	</div>
</div>
