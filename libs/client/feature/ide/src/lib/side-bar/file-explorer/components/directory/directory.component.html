<div class="directory" data-test="directory">
	<button
		mat-button
		disableRipple="true"
		[contextMenu]="directoryContextMenu"
		(click)="toggleIsExpanded()"
		(middleclick)="toggleIsExpanded()"
	>
		<kling-icon name="chevron_down" size="16" class="ml-[-1px]" *ngIf="isExpanded"></kling-icon>
		<kling-icon
			name="chevron_right"
			size="16"
			class="ml-[-1px]"
			*ngIf="!isExpanded"
		></kling-icon>
		<kling-icon name="folder" size="18" class="pl-[6px] pr-2 folder-icon"></kling-icon>
		<span class="directory-name">{{ directory.name }}</span>
	</button>

	<context-menu #directoryContextMenu>
		<ng-template
			contextMenuItem
			(execute)="workspaceDialogs.openCreateFileDialog(directory.path)"
		>
			<span class="context-menu-item" data-test="addFileBtn"
				><kling-icon name="note_add_filled" class="icon-light"></kling-icon
				>{{ "Action.Custom.AddFile" | translate }}</span
			>
		</ng-template>
		<ng-template
			contextMenuItem
			(execute)="workspaceDialogs.openCreateDirectoryDialog(directory.path)"
		>
			<span class="context-menu-item" data-test="addDirectoryBtn"
				><kling-icon name="create_new_folder_filled" class="icon-light"></kling-icon
				>{{ "Action.Custom.AddDirectory" | translate }}</span
			>
		</ng-template>
		<ng-template contextMenuItem (execute)="removeDirectoryIfConfirmed()">
			<span class="context-menu-item" data-test="deleteBtn"
				><kling-icon class="icon-light" name="delete"></kling-icon
				>{{ "Action.Delete" | translate }}</span
			>
		</ng-template>
	</context-menu>

	<div class="indent directory-content" *ngIf="isExpanded">
		<div class="files">
			<ng-container *ngFor="let file of files$ | async">
				<kling-file
					[file]="file"
					[isSelected]="selectedFilePath === file.path"
				></kling-file>
			</ng-container>
		</div>

		<div class="directories">
			<ng-container *ngFor="let dir of directories$ | async">
				<kling-directory
					[directory]="dir"
					[selectedFilePath]="selectedFilePath"
				></kling-directory>
			</ng-container>
		</div>
	</div>
</div>
